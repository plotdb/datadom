!function(){var o,g,v,e,d,t,u,n;"undefined"!=typeof module&&null!==module&&"undefined"!=typeof require&&null!==require&&(o=require("@plotdb/json0")),g=function(e,t){var n,r;for(null==e&&(e=[]),t=((t=(t=null==t?"":t).split("@"))[0]?[t[0],t[1]]:["@"+t[1],t[2]])[0],n=0,r=e.length;n<r;++n)if(t===e[n].name)return e[n];return null},v=function(e,t){if(Array.isArray(e.attr)&&e.attr.filter(function(e){return e&&e[0]}).map(function(e){return t.setAttribute(e[0],e[1])}),Array.isArray(e.style)&&e.style.filter(function(e){return e&&e[0]}).map(function(e){return t.style[e[0]]=e[1]}),Array.isArray(e.cls))return t.classList.add.apply(t.classList,e.cls.filter(function(e){return e}))},e=function(e,d,t){var c;return null==t&&(t=window),d=Array.isArray(d)?d:d?[d]:[],c=[],Promise.resolve().then(function(){var l=function(i){var e,t,n,r,o,u,a,s=i.nodeName.toLowerCase();switch(s){case"#text":return{type:"text",value:i.nodeValue};case"#comment":return{type:"comment",value:i.nodeValue};case"#document-fragment":for(e={type:"document-fragment",child:[]},t=0,n=i.childNodes.length;t<n;++t)(o=l(i.childNodes[r=t]))&&e.child.push(o);return e;default:if(e={style:i.style?function(){for(var e=[],t=0,n=i.style.length;t<n;++t)r=t,e.push(r);return e}().map(function(e){return[i.style[e],i.style[i.style[e]]]}):[],attr:i.attributes?function(){for(var e,t=[],n=0,r=(e=i.attributes).length;n<r;++n)u=e[n],t.push([u.nodeName,u.nodeValue]);return t}().filter(function(e){var t;return!(/^dd-/.exec(e[0])||"style"===(t=e[0])||"class"===t)}):[],cls:i.classList?function(){for(var e,t=[],n=0,r=(e=i.classList).length;n<r;++n)u=e[n],t.push(u);return t}():[],child:[],plug:[]},i.hasAttribute("dd-plugin"))return e.type="custom",(a=g(d,i.getAttribute("dd-plugin")))?(e.plugin=a.name+"@"+a.version,(o=a.serialize({data:e,node:i,window:window,plugins:d}))instanceof Promise&&c.push(o)):e.plugin="unknown",e;for(t=0,n=i.childNodes.length;t<n;++t)(o=l(i.childNodes[r=t]))&&e.child.push(o);return e.type="tag",e.name=s,e}};return l(e)}).then(function(e){return{data:e,promise:Promise.all(c)}})},d=function(e,h,f){var m,y;return null==f&&(f=window),h=Array.isArray(h)?h:h?[h]:[],m=f.document,y=[],Promise.resolve().then(function(){var p=function(t){var n,e,r,i,o,u,a,s,l,d,c;switch(t.type){case"text":return m.createTextNode(t.value);case"comment":return m.createComment(t.value);case"document-fragment":for(n=m.createDocumentFragment(),e=0,i=(r=t.child||[]).length;e<i;++e)o=r[e],(u=p(o))&&n.appendChild(u);return n;case"tag":for(n=m.createElement(t.name),v(t,n),e=0,i=(r=t.child||[]).length;e<i;++e)o=r[e],(u=p(o))&&n.appendChild(u);return n;default:for(r=[m.createElement("div"),null],n=r[0],a=r[1],e=0,i=(r=t.child||[]).length;e<i;++e)o=r[e],(u=p(o))&&n.appendChild(u);for(l=[],e=0,i=(r=t.plug||[]).length;e<i;++e)o=r[e],l.push(p(o));return(s=l,d=g(h,t.plugin))?((u=d.deserialize({data:t,node:n,plugs:s,window:f,plugins:h}))?u instanceof Promise?(n.appendChild(c=m.createTextNode("(.. loading ..)")),a=u.then(function(e){return c.parentNode&&c.parentNode.removeChild(c),n!==e&&n.replaceWith(e),e.setAttribute("dd-plugin",d.name+"@"+d.version),v(t,e),e})):u instanceof f.Element?n=u:(n=u.node,a=u.promise):n.appendChild(m.createTextNode("(unknown)")),a&&y.push(a),n.setAttribute("dd-plugin",d.name+"@"+d.version),v(t,n),n):(n.appendChild(m.createTextNode("(unknown)")),n)}};return p(e)}).then(function(e){return{node:e,promise:Promise.all(y)}})},t=function(o,u,e){var a;return null==e&&(e=window),u=Array.isArray(u)?u:u?[u]:[],a=[],Promise.resolve().then(function(){var i=function(e){var t,n,r;if(e.hasAttribute("dd-plugin")){if(r=g(u,o.getAttribute("dd-plugin")))return(r=r.possess({node:o,plugins:u,window:window}))instanceof Promise?a.push(r):void 0}else for(t=0,n=e.childNodes.length;t<n;++t)i(e.childNodes[t])};return i(o)}).then(function(){return Promise.all(a)})},u=function(n,e,t){r=t;for(var r,i,o,u,a,s=e,l=n.p.length-1;0<=l&&("attr"!==(o=n.p[i=l])&&"style"!==o&&"cls"!==o&&"child"!==o&&"name"!==o&&"value"!==o&&"type"!==o);--l);for(l=0,u=i-1;l<u;++l)a=n.p[i],r="child"===a?r.childNodes:r,s=s[a];switch(n.p[i]){case"name":case"value":case"type":return d(s).then(function(e){var t=e.node;e.promise;return r.parentNode.insertBefore(t,r),r.parentNode.removeChild(r)});case"style":return r.setAttribute("style",""),s.style.map(function(e){return r.style[e[0]]=e[1]});case"cls":return r.setAttribute("class",s.cls.join(" "));case"attr":return Array.from(r.attributes).map(function(e){var t;if(!s.attr[e.name]&&"custom"!==(t=e.name)&&"style"!==t&&"class"!==t)return r.removeAttribute(e.name)}),s.attr.map(function(e){return r.setAttribute(e[0],e[1])});case"child":if(n.ld&&r.removeChild(r.childNodes[n.p[i+1]]),n.li)return d(n.li).then(function(e){var t=e.node;e.promise;return r.insertBefore(t,r.childNodes[n.p[i+1]])})}},(n=function(e){var t;return this.opt=e=null==e?{}:e,this.window=(t=e.window)?t:"undefined"!=typeof window&&null!==window?window:null,this.plugins=Array.isArray(e.plugins)?e.plugins:e.plugins?[e.plugins]:[],e.data?this.data=e.data:e.node&&(this.node=e.node),this}).prototype=function(e,t){var n,r={}.hasOwnProperty;for(n in t)r.call(t,n)&&(e[n]=t[n]);return e}(Object.create(Object.prototype),{init:function(){var n=this;return this.data?d(this.data,this.plugins,this.window).then(function(e){var t=e.node,e=e.promise;return{node:n.node=t,promise:e}}):(this.node||(this.node=document.createElement("div")),e(this.node,this.plugins,this.window).then(function(e){var t=e.data,e=e.promise;return{data:this.data=t,promise:e}}))},getData:function(){return this.data},getNode:function(){return this.node},update:function(e){for(var t,n=[],r=0,i=(e=null==e?[]:e).length;r<i;++r)t=e[r],o.type.apply(this.data,[t]),n.push(u(t,this.data,this.node));return n}}),n.serialize=e,n.deserialize=d,n.possess=t,"undefined"!=typeof module&&null!==module?module.exports=n:"undefined"!=typeof window&&null!==window&&(window.datadom=n)}.call(this);
