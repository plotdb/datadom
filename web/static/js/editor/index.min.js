function import$(e,n){var t,r={}.hasOwnProperty;for(t in n)r.call(n,t)&&(e[t]=n[t]);return e}!function(){return i={},e=new sharedbWrapper({url:{}}),n=function(e,n){var t;return json0.type.apply(i.data,e),(t=ld$.find("[ld=remote]",0)).innerHTML="",datadom.deserialize(i.data,o).then(function(e){var n=e.node;e.promise;return t.appendChild(n),n="//- pug\n"+html2pug(t.innerHTML,{fragment:!0}),ld$.find("[ld=pug]",0).innerText=n})},(r=function(e){return this.data={data:(e=(e=null==e?{}:e).data||{}).data,dev:e.dev},this.data.dev=!0,this}).prototype=import$(Object.create(Object.prototype),{serialize:function(){var e;return{data:(e=this.data).data,dev:e.dev}}}),window.pt=a={name:"plugin-test",version:"0.0.1",map:{set:function(e,n){return console.log(e),a.map.wm||(a.map.wm=new WeakMap),a.map.wm.set(e,n)},get:function(e){return a.map.wm||(a.map.wm=new WeakMap),a.map.wm.get(e)}},serialize:function(e){var n=e.data,t=e.node,r=e.plugins;e.window;return console.log("serialize ",t),(e=a.map.get(t))&&import$(n,e.serialize()),Promise.all(Array.from(t.childNodes).map(function(e,n){return datadom.serialize(e,r)})).then(function(e){return n.child=n.child.concat(e.map(function(e){return e.data})),Promise.all(e.map(function(e){return e.promise}))})},deserialize:function(e){var n=e.data,t=e.node;e.plugs,e.plugins,e.window;return console.log("deserialize",t),a.map.set(t,new r({data:n})),console.log("reget",a.map.get(t)),t}},o=[block.plugin,a],block.plugin.init().then(function(){new ldview({root:document.body,action:{click:{"load-ce":function(){return fs.writeFileSync("blank",'//- pug\ndiv(dd-plugin="plugin-test@0.0.1") hi'),i.ed.setFiles(fs),i.ed.open("blank"),i.ed.render()},"load-block":function(){return fs.writeFileSync("blank",'//- pug\ndiv(dd-plugin="@plotdb/block@0.0.1",name="long-answer")'),i.ed.setFiles(fs),i.ed.open("blank"),i.ed.render()}}}});return e.get({id:"sample",watch:n,create:function(){return{}}}).then(function(r){return i.doc=r,i.data=JSON.parse(JSON.stringify(r.data)),getfa("sample").then(function(e){var a,n;return(i.fs=e).writeFileSync("blank","//- pug\nh1 hello world!"),a=function(e){var n=document.createElement("div");return n.innerHTML=e,datadom.serialize(n,o).then(function(e){var n=e.data;return e.promise.then(function(){return n})}).then(function(e){var t;return ld$.find("[ld=json]",0).innerText=JSON.stringify(e,null,2),t=ld$.find("[ld=dom]",0),datadom.deserialize(e,o).then(function(e){var n=e.node,e=e.promise;return t.innerHTML="",t.appendChild(n),e.then(function(){return datadom.serialize(n,o)})}).then(function(e){var n=e.data;return e.promise.then(function(){return console.log(n)})}),e=json0.diff(r.data,e),r.submitOp(e)})},i.ed=n=new Editor({node:{edit:"[ld=editor]",view:"[ld=viewer]"},editlet:{},renderer:function(e){var n,t,r,i,e=e.fs;if(e){for(t in n={html:e.readFileSync("blank").toString()})r=n[t],(i=transpiler.detect(r)).mod&&i.mod.transform&&(n[t]=i.mod.transform(r)),a(n.html);return n}}}),n.setFiles(e),n.open("blank")})})});var i,e,n,r,a,o}();